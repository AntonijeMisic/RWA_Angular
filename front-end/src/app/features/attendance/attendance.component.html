<div class="attendance-wrapper">
  <header class="attendance-header">
    <h2>Attendance - Weekly Overview</h2>
  </header>

  <div class="attendance-table-wrap">
    <table class="attendance-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Day</th>
          <th>Start</th>
          <th>End</th>
          <th>Break (min)</th>
          <th>Work Type</th>
          <th>Total hrs</th>
          <th>Note</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of weeklyLogs()">
          <td>{{ item.day | date: 'dd.MM.yyyy' }}</td>
          <td>{{ item.day | date: 'EEE' }}</td>
          <td>{{ item.log?.clockIn ? (item.log?.clockIn | date:'HH:mm:ss') : '-' }}</td>
          <td>{{ item.log?.clockOut ? (item.log?.clockOut | date:'HH:mm:ss') : '-' }}</td>
          <td>{{ item.log?.breakMinutes ? (item.log?.breakMinutes | number:'1.2-2') : (item.isWeekend || item.isLeave ? '-' : '0.00') }}</td>
          <td>{{ item.log?.workType?.workTypeName || '-' }}</td>
          <td>{{ convertTotalHoursToHHMMSS(item.log?.totalHours) }}</td>
          <td>{{ item.isLeave ? 'Day off' + ' - ' + item.leaveType : '-'}}</td>
          <td>
            <div *ngIf="item.isToday && !item.isWeekend && !item.isLeave; else emptyCell">
              <button class="btn small clock-in"
                      (click)="openWorkTypeDialog(item.day)"
                      [disabled]="item.isWeekend || item.log?.clockIn">
                Clock In
              </button>

              <button class="btn small clock-out"
                      (click)="clockOut(item.day)"
                      [disabled]="item.isWeekend || !item.log?.clockIn || item.log?.clockOut">
                Clock Out
              </button>

              <button class="btn small break-btn"
                      (click)="takeBreak(item.day)"
                      [disabled]="item.isWeekend || !item.log?.clockIn || item.log?.clockOut || item.log?.breakMinutes">
                {{ isOnBreak() ? 'Resume Work' : 'Take a Break' }}
              </button>
            </div>

            <ng-template #emptyCell>
              <span class="muted">-</span>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<app-work-log-dialog
  *ngIf="showWorkTypeDialog"
  (confirmSelection)="onWorkTypeSelected($event)"
  (cancelSelection)="onWorkTypeDialogCancel()">
</app-work-log-dialog>
