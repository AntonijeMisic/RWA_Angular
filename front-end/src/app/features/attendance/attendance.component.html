<div class="attendance-wrapper">
  <header class="attendance-header">
    <h2>Attendance - Weekly Overview</h2>
  </header>

  <div class="attendance-table-wrap">
    <table class="attendance-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Day</th>
          <th>Start</th>
          <th>End</th>
          <th>Break (min)</th>
          <th>Work Type</th>
          <th>Total hrs</th>
          <th>Note</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        @for (item of weeklyLogs(); track item.day) {
          <tr>
            <td>{{ item.day | date: 'dd.MM.yyyy' }}</td>
            <td>{{ item.day | date: 'EEE' }}</td>

            <td>
              @if (item.log?.clockIn) {
                {{ item.log!.clockIn | date: 'HH:mm:ss' }}
              }
              @else {
                -
              }
            </td>

            <td>
              @if (item.log?.clockOut) {
                {{ item.log!.clockOut | date: 'HH:mm:ss' }}
              }
              @else {
                -
              }
            </td>

            <td>
              @if (item.log?.breakMinutes) {
                {{ item.log!.breakMinutes | number: '1.2-2' }}
              }
              @else {
                @if (item.isWeekend || item.isLeave) {
                  -
                }
                @else {
                  0.00
                }
              }
            </td>

            <td>{{ item.log?.workType?.workTypeName ?? '-' }}</td>

            <td>{{ convertTotalHoursToHHMMSS(item.log?.totalHours) }}</td>

            <td>
              @if (item.isLeave) {
                Day off - {{ item.leaveType }}
              }
              @else {
                -
              }
            </td>

            <td>
              @if (item.isToday && !item.isWeekend && !item.isLeave) {

                <button class="btn small clock-in"
                        (click)="openWorkTypeDialog(item.day)"
                        [disabled]="item.isWeekend || item.log?.clockIn">
                  Clock In
                </button>

                <button class="btn small clock-out"
                        (click)="clockOut(item.day)"
                        [disabled]="item.isWeekend || !item.log?.clockIn || item.log?.clockOut">
                  Clock Out
                </button>

                <button class="btn small break-btn"
                        (click)="takeBreak(item.day)"
                        [disabled]="item.isWeekend || !item.log?.clockIn || item.log?.clockOut || item.log?.breakMinutes">
                  {{ isOnBreak() ? 'Resume Work' : 'Take a Break' }}
                </button>

              }
              @else {
                <span class="muted">-</span>
              }
            </td>

          </tr>
        }
      </tbody>
    </table>
  </div>
</div>

@if (showWorkTypeDialog) {
  <app-work-log-dialog
    (confirmSelection)="onWorkTypeSelected($event)"
    (cancelSelection)="onWorkTypeDialogCancel()">
  </app-work-log-dialog>
}